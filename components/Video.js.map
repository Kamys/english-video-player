{"version":3,"file":"Video.js","sourceRoot":"","sources":["../../src/components/Video.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { MutableRefObject, useCallback, useEffect, useRef } from 'react'\nimport { useStore } from 'effector-react'\nimport { $sources } from '../store/sources'\nimport { $video } from '../store/video'\nimport { $translate } from '../store/translate'\nimport { getLastSub, getNextSub } from '../utils'\n\nconst { setCurrentMillisecond, setDuration, onTogglePlay } = $video.action\n\ninterface Props {\n    goToTime: number\n}\n\nconst useMove = (videoRef: MutableRefObject<HTMLVideoElement>) => {\n\n\n    useEffect(() => {\n        const onKeydown = (event) => {\n            const isArrowRight = event.key === \"ArrowRight\" || event.code === \"ArrowRight\" || event.keyCode === 39\n            const isArrowLeft = event.key === \"ArrowLeft\" || event.code === \"ArrowLeft\" || event.keyCode === 37\n\n            if (isArrowRight) {\n                let nextSub = getNextSub(videoRef.current.currentTime * 1000)\n                videoRef.current.currentTime = nextSub / 1000\n            }\n            if (isArrowLeft) {\n                videoRef.current.currentTime = getLastSub(videoRef.current.currentTime * 1000) / 1000\n            }\n        }\n        window.addEventListener('keydown', onKeydown)\n\n        return () => window.removeEventListener('keydown', onKeydown)\n    }, [])\n}\n\nexport const Video: React.FC<Props> = ({ goToTime }) => {\n    const videoRef = useRef<HTMLVideoElement>()\n    const { isPlay  } = useStore($video.store)\n    const { videoSrc } = useStore($sources.store)\n\n    useEffect(() => {\n        const video = videoRef.current\n        if (isPlay) {\n            video.play()\n            $translate.action.onTranslate(null)\n        } else {\n            video.pause()\n        }\n    }, [isPlay])\n\n    useEffect(() => {\n        videoRef.current.currentTime = goToTime / 1000\n    }, [goToTime])\n\n    useEffect(() => {\n        let current = videoRef.current\n        const onTimeupdate = () => {\n            const millisecond = current.currentTime * 1000\n            setCurrentMillisecond(millisecond)\n            setDuration(current.duration * 1000)\n        }\n        current.addEventListener('timeupdate', onTimeupdate)\n\n        return () => current.removeEventListener('timeupdate', onTimeupdate)\n    }, [])\n\n    useMove(videoRef)\n\n    useEffect(() => {\n        const onKeydown = (event) => {\n            const isSpace = event.key === ' ' ||  event.code === 'Space' || event.keyCode === 32\n            if (isSpace) {\n                onTogglePlay()\n                event.preventDefault()\n                event.stopPropagation()\n            }\n        }\n        window.addEventListener('keydown', onKeydown)\n\n        return () => window.removeEventListener('keydown', onKeydown)\n    }, [])\n\n    const handleTogglePlay = useCallback(() => {\n        onTogglePlay()\n    }, [])\n\n    return (\n        <video onClick={handleTogglePlay} ref={videoRef} className='video' controls={false}>\n            <source src={videoSrc} />\n        </video>\n    )\n}"]}